\section{总结}\label{summary}

光阴似箭。自 2021 年 10 月初毕业实训与毕业设计题目上报开始，到 2022 年 5 月毕业设计论文的撰写结束，将近 7 个月的毕业设计即将落下帷幕了。毕业设计作为本科学习生涯中最后一道关卡和最重要的一项设计任务，同时也象征着本科阶段的总结与新阶段的开启。在此次毕业设计中，我自认无愧于大学本科四年来所获得的理论知识与实践本领，本次毕业设计项目算是我交给过往四年的一份较为满意的答卷。对此，我进行了如下总结。

\subsection{毕业设计总体执行情况}

毕业设计作为本科四年学习过程的最后一个任务，不仅需要综合考察所学专业知识与技能本领，还需要作为总结过往、开启未来新阶段的一项工作。作为同济大学电子与信息工程学院计算机科学与技术系的一名学生，我能够感受到学院各级领导对本科生毕业设计任务的重视程度——去年下半年的毕业实训与毕业设计动员会令我对毕业设计的重要性有了极其明确的认识。这也使得我在上学期末认真地撰写了毕业实训报告，并对本学期的毕业设计任务进行展望。

我在本次毕业设计过程中接触了先前从未接触过的计算机科学领域中的一个方向，在导师的指导下从无到有地建立了理论基础、获得了实践经验。

在这过程中，我首先接触了 AOSP 的构建系统，阅读了 soong 构建系统中 soong-ui、Blueprint 等模块以及 Ninja 构建系统的大部分源码，共计 30000 余行。我通过该阶段对 Ninja 构建步骤以及 Ninja 内部各关键数据结构有了一定的掌握，这为我后续在代码规模 1 万余行的 Ninja 上继续开发新功能做了铺垫。

此后，我学习并阅读了 Ninja 用于描述构建过程的清单文件。现代移动端操作系统无论在源代码还是最终的构建产物都是一个庞大的巨无霸，以至于用于描述其构建过程的文本文件就有 2.7 GB 左右的大小。阅读并从该文件中提取有效信息是整个毕业设计中最为困难、最为耗神的步骤。在该阶段，我将 build.ninja 文件、soong Blueprint 模块源代码以及 Ninja 构建系统源代码结合起来阅读，这使得我成功总结出 build.ninja 中的特殊文件格式，令我后续的开发得以顺利进行。

紧接着，我学习了多种变更相关工具的理念和使用。我较为深入的了解了现今 git diff 所使用的算法，学习了 gumTree 与 CLDIFF 的使用。优雅地设计变更获取模块并不是一件简单的事，我曾纠结于使用 jdt AST 还是 gumTree 提供的结构，也曾纠结于 CLDIFF 在算法实现方面提供的简便与其他开源库的便捷。最后我仍屈服于 gumTree 的便捷，使得我的程序略显丑陋。

最后，我学习了多种开源调用图生成工具的使用。无论是 Soot、WALA 还是 Java Call Graph，都存在文档落后、不适配现有场景的问题。解决该问题是一条漫长的道路，我从零开始，从 JVM 类加载过程开始学习，从类文件结构开始学习，一点一点地发现、归纳、搜索、学习并解决面前的问题，这才有了 cg\_generator 简短的 1000 余行代码。

本次毕业设计选题与实际应用具有较紧密联系，时间较长，内容较为充实——我阅读了近 30 篇文献，阅读了 30000 余行代码，上文中所设计的系统涉及 8 个代码仓库，并使用了 7 种不同的通用编程语言开发，仓库内代码近 8000 行，能够完成任务书中描述的功能。毕业设计总体执行情况较为顺利。

\begin{itemize}
    \item 从本学期第 1 周开始，我以上学期的毕业实训中所做理论铺垫为基础，深入阅读了 soong 构建系统中 Blueprint 部分与 bootstrap 部分的源代码（10k LoC）、Ninja 中有关构建过程与插件功能的源代码（10k LoC），证明了模块间变更分析模块实现的可行性。
    \item 第 2 周到第 4 周，我基于第 1 周所学习到的理论，为 Ninja 构建系统增加特性，并对毕业实训中设计的工具进行修改。
    \item 第 5 周到第 6 周，我通过阅读相关文献以及学习 jgit 与 jdt 的使用，获得变更差异具体到源文件的影响。
    \item 第 7 周到第 11 周，我学习了各种开源程序分析框架的用法，学习了 JVM 字节码操作库 Apache BCEL，并修改 Java Call Graph 令其能够使用 AOSP 中的 jar 文件生成调用图。与此同时，我完成了论文翻译工作。
    \item 第 12 周及以后，我逐步撰写毕业论文。
\end{itemize}

\subsection{毕业设计中遇到的困难}

在毕业设计过程中，我确实遇到了诸多方面的困难，其中甚至有部分难题令我一度以为毕业设计不存在实际可行性，也有部分困难在毕业设计中没有得到解决。

\subsubsection{相关资料的匮乏}

本次毕业设计以 AOSP 为背景，然而中文互联网中与 Android 相关的资料大部分与 Android 开发有关，而与 AOSP 体系结构、构建系统相关资料较为匮乏。另一方面，Android 生态较为活跃，网络上可获取的资料大部分也不具备时效性（例如，我曾浏览过有关 Android.mk 书写规范的博客，但 Android Marshmallow 后逐渐使用 Android.bp 代替前者）。

\subsubsection{开源工具难以直接处理实际问题}

在计划生成调用图时，我调研过部分开源程序分析框架。但与 AOSP 类似的，这些框架作为实验室产品（非商业级应用）也具有缺乏文档说明、缺乏开发团队维护的缺陷。由于我本人理论基础与实践经验的不足，在框架的应用理解上也缺乏触类旁通、举一反三的快速学习能力。因此，存在相当长的一段时间，我认为通过开源工具生成调用图还不如自己实现。

\subsubsection{外界环境因素的干扰}

2022 年 4 月 3 日，嘉定校区正式开始封闭式管理。也许是我个人意志不坚定的缘故，长期封闭式管理确实对我的作息以及生活安排造成了一定影响。

\subsection{毕业设计感想}

本次毕业设计使我回忆起了学习的感觉。我非常高兴的是，在此次过程中，我接触了一个之前没有了解过的新领域，我也因此久违地体验到了学习的痛苦与乐趣。此前近两年时间，我都在舒适的浅水区中游泳，等到这次毕业设计的海浪拍向我，我才回忆起刚进入大学时、刚接触本专业的学习时、刚敲下第一行代码时的那份谨慎小心。

本次毕业设计使我认可了自己的学习经历。由于本课题是在我刚刚确认导师后不久得到的，因此我最初对其并无任何了解。在我逐渐了解课题后，令我感到惊讶的是，该课题看似是一项工程任务，但涉及的核心算法却涉及到数据结构与离散数学课程中学习到的知识。例如，在阅读 Ninja 源代码时，我能够直接看出其中各个工具使用的算法。这令我非常激动。

但同时，我必须承认本次毕业设计暴露出了我专业能力不足的问题。我本人在工程能力上仍有较大的缺陷——开发某模块后，不出两周就需要重新理解，这说明我个人的代码规范以及对项目的掌控能力不足。同时，在开发中我两次遭遇到已完成的模块间不能联通的情况，这说明我对项目的标准控制不足。我还有很长一段路要走。

在本科的最后一学期中，我通过该课题不断学习的过程中不断丰富理论知识，在不断开发的过程中不断提高实践本领。在老师的指导下一步步从开题报告、中期报告走到毕业论文这一关。本次毕业设计是对我个人四年以来所学专业技能的一个巩固与考察，让我理解了本科阶段所学知识的重要性，也提醒了我作为一名计算机专业学生需要持之以恒、积极进取、“终身学习”。

\subsection{对该工作未来的展望}

AOSP 作为 Google 主导维护的 Android 系统开源项目集合，是各大移动设备厂商关注的焦点。AOSP 庞大的体系架构中包含难以预估的复杂性，无论是对软件工程理论在实践中的应用，还是自动化、智能化工具在研发流程上的使用，都是一种巨大的考验。本文所设计的系统仅是围绕 AOSP 构建系统展开的应用开发，而 AOSP 还有许多主题或特性会为研发流程带来负担，如对新增代码的代码复杂度确定、基于目标仓库变更的文档生成、对合码过程中自研代码对 AOSP 各仓库的依赖面确定等。
